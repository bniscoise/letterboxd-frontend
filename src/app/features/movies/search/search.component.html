<!-- Champ de recherche temps réel -->
<div class="mb-6">
  <label class="mb-2 block text-sm font-semibold text-monokai-cyan">Rechercher un film</label>
  <div class="relative">
    <input
      [formControl]="queryControl"
      placeholder="Votre film préféré ?"
      class="w-full rounded-lg border border-monokai-border bg-monokai-surface-highlight/70 px-4 py-3 text-monokai-text shadow-inner focus:outline-none focus:ring-2 focus:ring-monokai-accent focus:border-monokai-accent placeholder:text-monokai-muted transition"
    />
    <span class="pointer-events-none absolute right-3 top-1/2 -translate-y-1/2 text-monokai-muted">&#8983;</span>
  </div>
</div>

<!-- Loader -->
@if (loading()) {
  <div class="flex items-center justify-center gap-3 rounded-lg border border-dashed border-monokai-border bg-monokai-surface-highlight/60 py-6 text-monokai-muted">
    <div class="h-8 w-8 animate-spin rounded-full border-2 border-monokai-border border-t-monokai-accent"></div>
    <span>Recherche en cours...</span>
  </div>
}

<!-- Message d'aide -->
@if (!searchPerformed() && !loading()) {
  <div class="rounded-lg border border-dashed border-monokai-border bg-monokai-surface-highlight/60 p-6 text-center text-sm text-monokai-muted">
    <p>Commencez par saisir le nom d'un film pour explorer la base de données.</p>
  </div>
}

<!-- Aucun résultat -->
@if (!loading() && searchPerformed() && movies().length === 0) {
  <div class="rounded-lg border border-dashed border-monokai-border bg-monokai-surface-highlight/60 p-6 text-center text-sm text-monokai-muted">
    <p>Aucun résultat pour "{{ queryControl.value }}"</p>
  </div>
}

<!-- Liste des films -->
@if (movies().length > 0) {
  <ul class="space-y-4">
    @for (movie of pagedMovies(); track trackById($index, movie)) {
      <li class="flex gap-5 rounded-xl border border-monokai-border bg-monokai-surface-highlight/70 p-5 shadow transition hover:shadow-monokai">
        @if (movie.posterUrl) {
          <img
            [src]="movie.posterUrl"
            width="100"
            height="150"
            [alt]="movie.title"
            class="h-[150px] w-[100px] rounded object-cover shadow-inner"
          />
        } @else {
          <div class="flex h-[150px] w-[100px] items-center justify-center rounded border border-monokai-border bg-monokai-surface">
            <span class="text-center text-xs text-monokai-muted">Pas d'image</span>
          </div>
        }

        <div class="flex-1 space-y-3">
          <div>
            <h3 class="text-xl font-semibold text-monokai-text">{{ movie.title }}</h3>
            <p class="text-sm uppercase tracking-wide text-monokai-muted">{{ movie.year }}</p>
          </div>

          @if (movie.aggregateRating !== undefined) {
            <p class="text-sm font-medium text-monokai-yellow">
              ⭐ {{ movie.aggregateRating }}/10
              @if (movie.voteCount) {
                <span class="ml-1 text-xs text-monokai-muted">({{ movie.voteCount }} votes)</span>
              }
            </p>
          }
          <div>
            <button class="px-4 py-3 bg-monokai-green rounded-lg text-monokai-background">
              Ajouter à votre liste
            </button>
          </div>
        </div>
      </li>
    }
  </ul>

  @if (totalPages() > 1) {
    <nav class="mt-6 flex items-center justify-center gap-3 text-sm">
      <button
        class="rounded-lg border border-monokai-border bg-monokai-surface px-3 py-2 text-monokai-muted transition hover:text-monokai-text disabled:cursor-not-allowed disabled:opacity-50"
        (click)="previousPage()"
        [disabled]="currentPage() === 1"
      >
        Précédent
      </button>

      <div class="flex items-center gap-2">
        @for (page of pageNumbers(); track $index) {
          <button
            class="min-w-[2.5rem] rounded-lg px-3 py-2 text-center transition"
            [ngClass]="{
              'bg-monokai-accent text-monokai-background shadow-monokai': page === currentPage(),
              'border border-monokai-border bg-monokai-surface text-monokai-muted hover:text-monokai-text': page !== currentPage()
            }"
            (click)="goToPage(page)"
          >
            {{ page }}
          </button>
        }
      </div>

      <button
        class="rounded-lg border border-monokai-border bg-monokai-surface px-3 py-2 text-monokai-muted transition hover:text-monokai-text disabled:cursor-not-allowed disabled:opacity-50"
        (click)="nextPage()"
        [disabled]="currentPage() === totalPages()"
      >
        Suivant
      </button>
    </nav>
  }
}
